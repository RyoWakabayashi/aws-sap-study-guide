# セキュリティ

<!-- 
Copyright (c) 2025 AWS SAP Study Guide
Licensed under the MIT License. See LICENSE file for details.
-->

## 目次

1. [IAM (Identity and Access Management)](#iam-identity-and-access-management)
2. [データ保護・暗号化](#データ保護暗号化)
3. [ネットワークセキュリティ](#ネットワークセキュリティ)
4. [脅威検知・対応](#脅威検知対応)
5. [コンプライアンス・ガバナンス](#コンプライアンスガバナンス)
6. [セキュリティ設計パターン](#セキュリティ設計パターン)

---

## IAM (Identity and Access Management)

### 基本概念と原則

IAMの基本要素

- **ユーザー**: 個人またはアプリケーションのアイデンティティ
- **グループ**: ユーザーの論理的な集合
- **ロール**: 一時的な権限の付与
- **ポリシー**: 権限の定義（JSON形式）

セキュリティ原則

- **最小権限の原則**: 必要最小限の権限のみ付与
- **職務分離**: 責任の分散、権限の分離
- **定期的なレビュー**: アクセス権限の定期見直し
- **多要素認証**: 追加の認証要素

### ユーザー・グループ管理

ユーザー管理のベストプラクティス

- **個人アカウント**: 共有アカウントの禁止
- **強力なパスワード**: パスワードポリシーの設定
- **MFA有効化**: 特に特権ユーザー
- **アクセスキー管理**: 定期的なローテーション

グループ設計

- **職務ベース**: 職務に応じたグループ分け
- **階層構造**: 権限レベルに応じた階層化
- **管理効率**: グループ単位での権限管理
- **監査性**: 権限付与の透明性

### ロールベースアクセス制御

IAMロールの利点

- **一時的認証情報**: セキュリティトークンの自動ローテーション
- **クロスアカウント**: 異なるAWSアカウント間のアクセス
- **フェデレーション**: 外部IDプロバイダーとの統合
- **サービス統合**: AWSサービス間の安全な連携

ロール設計パターン

- **サービスロール**: EC2、Lambda等のサービス用
- **クロスアカウントロール**: アカウント間アクセス
- **フェデレーションロール**: SAML、OIDC統合
- **一時的ロール**: 短期間の特権アクセス

信頼関係とAssumeRole

- **信頼ポリシー**: ロールを引き受け可能なプリンシパル
- **条件**: IP制限、時間制限、MFA要求
- **外部ID**: クロスアカウントアクセスの追加セキュリティ
- **セッション期間**: 一時的認証情報の有効期間

### ポリシー設計

ポリシータイプ

- **管理ポリシー**: 再利用可能、バージョン管理
- **インラインポリシー**: 特定のプリンシパルに直接アタッチ
- **AWSマネージドポリシー**: AWS提供の標準ポリシー
- **カスタマーマネージドポリシー**: 組織固有のポリシー

ポリシー要素

- **Effect**: Allow/Deny
- **Action**: 許可/拒否するアクション
- **Resource**: 対象リソース
- **Condition**: 条件付きアクセス

条件キーの活用

- **時間ベース**: 特定時間帯のみアクセス許可
- **IPベース**: 特定IPからのみアクセス許可
- **MFA**: 多要素認証必須
- **リクエスト属性**: User-Agent、リファラー等

### フェデレーション

SAML 2.0フェデレーション

- **用途**: 企業のActive Directory統合
- **メリット**: 既存ID基盤の活用、SSO実現
- **実装**: ADFS、Okta、Azure AD等との統合
- **考慮事項**: 証明書管理、属性マッピング

OpenID Connect (OIDC)

- **用途**: Web/モバイルアプリケーション
- **プロバイダー**: Google、Facebook、Amazon Cognito
- **メリット**: 標準プロトコル、簡単な実装
- **セキュリティ**: JWTトークンの検証

AWS SSO (Identity Center)

- **統合管理**: 複数AWSアカウントの統一管理
- **外部統合**: Active Directory、外部IDプロバイダー
- **アプリケーション統合**: SaaSアプリケーションのSSO
- **権限セット**: 標準化された権限管理

### 公式リソース

- [IAM サービス紹介](https://aws.amazon.com/jp/iam/)
- [IAM Black Belt](https://pages.awscloud.com/rs/112-TZM-766/images/AWS-Black-Belt_2024_AWS-IAM-Access-Analyzer_1231_v1.pdf)

---

## データ保護・暗号化

### 暗号化の基本概念

暗号化の種類

- **保存時暗号化**: データストレージでの暗号化
- **転送時暗号化**: 通信経路での暗号化
- **処理時暗号化**: メモリ上での暗号化
- **エンドツーエンド暗号化**: 送信者から受信者まで

暗号化レベル

- **アプリケーションレベル**: アプリケーション内での暗号化
- **データベースレベル**: データベースエンジンでの暗号化
- **ファイルシステムレベル**: OSレベルでの暗号化
- **ハードウェアレベル**: ハードウェアでの暗号化

### AWS Key Management Service (KMS)

基本概念

- **マネージドサービス**: キー管理の自動化
- **HSM**: ハードウェアセキュリティモジュール
- **キーローテーション**: 自動的なキー更新
- **監査**: CloudTrailでのキー使用ログ

キータイプ

- **AWS管理キー**: AWSサービスが自動作成・管理
- **カスタマー管理キー**: 顧客が作成・管理
- **カスタマー提供キー**: 顧客がキーマテリアルを提供
- **CloudHSM**: 専用HSMでのキー管理

キーポリシー

- **リソースベース**: キー自体に設定されるポリシー
- **プリンシパル**: キーを使用可能なユーザー・ロール
- **アクション**: 暗号化、復号化、キー管理
- **条件**: 使用条件の制限

#### 公式リソース

- [KMS サービス紹介](https://aws.amazon.com/jp/kms/)
- [KMS Black Belt](https://d1.awsstatic.com/webinars/jp/pdf/services/20160928_AWS-BlackBelt-KMS.pdf)

### サービス別暗号化

S3暗号化

- **SSE-S3**: S3管理キー（AES-256）
- **SSE-KMS**: KMS管理キー、アクセスログ
- **SSE-C**: 顧客提供キー
- **クライアント側暗号化**: アプリケーションレベル

EBS暗号化

- **デフォルト暗号化**: アカウントレベルでの有効化
- **既存ボリューム**: スナップショット経由での暗号化
- **パフォーマンス**: 暗号化による性能影響は最小限
- **キー管理**: KMSとの統合

RDS暗号化

- **保存時暗号化**: データベース、ログ、バックアップ
- **転送時暗号化**: SSL/TLS接続
- **透過的暗号化**: アプリケーション変更不要
- **キー管理**: KMS統合、自動ローテーション

### 証明書管理

AWS Certificate Manager (ACM)

- **SSL/TLS証明書**: 無料のパブリック証明書
- **自動更新**: 証明書の自動更新
- **統合**: CloudFront、ELB、API Gateway
- **プライベート証明書**: 内部用途の証明書

証明書のライフサイクル

- **発行**: ドメイン検証、組織検証
- **デプロイ**: AWSサービスへの自動デプロイ
- **更新**: 期限前の自動更新
- **失効**: 必要に応じた証明書失効

#### 公式リソース

- [Certificate Manager サービス紹介](https://aws.amazon.com/jp/certificate-manager/)
- [Certificate Manager Black Belt](https://pages.awscloud.com/rs/112-TZM-766/images/AWS-Black-Belt_2023_AWS-Certificate-Manager_v1.pdf)

---

## ネットワークセキュリティ

### VPCセキュリティ

セキュリティグループ

- **ステートフル**: 戻りトラフィックの自動許可
- **ホワイトリスト**: 許可ルールのみ
- **動的参照**: 他のセキュリティグループの参照
- **最小権限**: 必要最小限のポート・プロトコル

Network ACL

- **ステートレス**: 明示的な双方向ルール
- **サブネットレベル**: サブネット全体への適用
- **ルール評価**: 番号順での評価
- **追加防御**: セキュリティグループとの多層防御

VPC設計のセキュリティ

- **プライベートサブネット**: 外部からの直接アクセス遮断
- **NAT Gateway**: アウトバウンド通信の制御
- **VPC Endpoint**: AWS内部通信、インターネット回避
- **Flow Logs**: ネットワークトラフィックの監視

### Web Application Firewall (WAF)

基本機能

- **SQLインジェクション**: データベース攻撃の防御
- **XSS**: クロスサイトスクリプティング対策
- **レート制限**: 過度なリクエストの制限
- **地理的制限**: 特定地域からのアクセス制御

ルール管理

- **マネージドルール**: AWS、サードパーティ提供
- **カスタムルール**: 独自の脅威パターン
- **ルールグループ**: 関連ルールの論理的グループ化
- **優先度**: ルール評価の順序制御

統合サービス

- **CloudFront**: グローバルな保護
- **Application Load Balancer**: リージョナルな保護
- **API Gateway**: API特化の保護
- **AppSync**: GraphQL API の保護

#### 公式リソース

- [WAF サービス紹介](https://aws.amazon.com/jp/waf/)
- [WAF Black Belt](https://pages.awscloud.com/rs/112-TZM-766/images/202206_AWS_Black_Belt_AWS_FirewallManager_For_AWS_WAF.pdf)

### DDoS保護

AWS Shield Standard

- **自動保護**: すべてのAWSリソース
- **Layer 3/4**: ネットワーク・トランスポート層
- **無料**: 追加コストなし
- **基本的な攻撃**: 一般的なDDoS攻撃への対応

AWS Shield Advanced

- **高度な保護**: アプリケーション層攻撃
- **24/7サポート**: DDoS Response Team (DRT)
- **攻撃分析**: 詳細な攻撃レポート
- **コスト保護**: DDoS攻撃によるスケーリングコスト保護

DDoS対策設計

- **分散アーキテクチャ**: 単一障害点の排除
- **Auto Scaling**: 攻撃時の自動スケーリング
- **CloudFront**: エッジでの攻撃軽減
- **Route 53**: DNS レベルでの保護

#### 公式リソース

- [Shield サービス紹介](https://aws.amazon.com/jp/shield/)
- [Shield Black Belt](https://pages.awscloud.com/rs/112-TZM-766/images/20200818_AWS_BlackBelt_AWS_Shield_Advanced.pdf)

---

## 脅威検知・対応

### Amazon GuardDuty

基本概念

- **脅威検知**: 機械学習による異常検知
- **データソース**: VPC Flow Logs、DNS Logs、CloudTrail
- **脅威インテリジェンス**: 既知の悪意のあるIPアドレス
- **継続監視**: 24/7の自動監視

検知対象

- **不正アクセス**: 異常なログイン、権限昇格
- **データ漏洩**: 異常なデータ転送
- **マルウェア**: C&C通信、暗号化マイニング
- **偵察活動**: ポートスキャン、脆弱性探索

対応アクション

- **EventBridge統合**: 自動対応の実装
- **Lambda統合**: カスタム対応ロジック
- **SNS通知**: アラート通知
- **Security Hub統合**: 統合セキュリティ管理

#### 公式リソース

- [GuardDuty サービス紹介](https://aws.amazon.com/jp/guardduty/)
- [GuardDuty Black Belt](https://pages.awscloud.com/rs/112-TZM-766/images/AWS-Black-Belt_2025_Amazon-GuardDuty-Basic_0131_v1.pdf)

### AWS Security Hub

統合セキュリティ管理

- **中央集約**: 複数セキュリティサービスの統合
- **標準化**: AWS Security Finding Format
- **優先度付け**: 脅威の重要度評価
- **ダッシュボード**: 統一されたセキュリティ状況表示

統合サービス

- **GuardDuty**: 脅威検知
- **Inspector**: 脆弱性評価
- **Macie**: データ分類・保護
- **Config**: 設定コンプライアンス

コンプライアンス標準

- **AWS Foundational Security Standard**: AWS基本セキュリティ
- **CIS**: Center for Internet Security
- **PCI DSS**: Payment Card Industry
- **SOC**: Service Organization Control

#### 公式リソース

- [Security Hub サービス紹介](https://aws.amazon.com/jp/security-hub/)
- [Security Hub Black Belt](https://d1.awsstatic.com/webinars/jp/pdf/services/20201013_AWS-BlackBelt-AWSSecurityHub.pdf)

### Amazon Inspector

脆弱性評価

- **EC2インスタンス**: OS、アプリケーション脆弱性
- **コンテナイメージ**: ECR内のイメージスキャン
- **Lambda関数**: 関数コード、依存関係
- **継続的評価**: 新しい脆弱性の自動検知

評価ルール

- **セキュリティベストプラクティス**: AWS推奨設定
- **ネットワーク到達性**: 不要なネットワークアクセス
- **ランタイム動作**: 実行時の異常動作
- **CVE**: Common Vulnerabilities and Exposures

### Amazon Macie

データ分類・保護

- **機械学習**: 自動的なデータ分類
- **個人情報検知**: PII、PHI、クレジットカード情報
- **S3監視**: バケット、オブジェクトの継続監視
- **異常検知**: 通常と異なるアクセスパターン

データ保護

- **データインベントリ**: データ資産の可視化
- **リスク評価**: データ露出リスクの評価
- **アクセス分析**: データアクセスパターンの分析
- **アラート**: 高リスクデータの検知通知

---

## コンプライアンス・ガバナンス

### AWS Config

設定管理・監査

- **設定記録**: AWSリソースの設定変更履歴
- **コンプライアンス評価**: 設定ルールとの適合性
- **変更追跡**: 設定変更の詳細記録
- **関係性**: リソース間の依存関係

Config Rules

- **AWS管理ルール**: AWS提供の標準ルール
- **カスタムルール**: Lambda関数による独自ルール
- **修復アクション**: 非準拠時の自動修復
- **評価トリガー**: 設定変更時、定期実行

### AWS CloudTrail

API監査ログ

- **全API記録**: すべてのAWS API呼び出し
- **データイベント**: S3オブジェクト、Lambda実行
- **管理イベント**: リソース作成・変更・削除
- **インサイトイベント**: 異常なAPI活動

ログ管理

- **S3保存**: 長期保存、ライフサイクル管理
- **CloudWatch統合**: リアルタイム監視、アラート
- **暗号化**: KMS暗号化、ログファイル整合性
- **マルチリージョン**: 全リージョンでの統一ログ

### AWS Organizations

マルチアカウント管理

- **組織単位**: 階層的なアカウント管理
- **統合請求**: 一元的な請求管理
- **Service Control Policy**: アカウント権限の制限
- **アカウント作成**: 自動化されたアカウント作成

ガバナンス

- **SCP**: 最大権限の制限
- **タグポリシー**: 統一されたタグ付けルール
- **バックアップポリシー**: 組織全体のバックアップ
- **AI Opt-out**: AI/ML サービスの利用制限

### AWS Control Tower

ランディングゾーン

- **マルチアカウント環境**: 標準化された環境構築
- **ガードレール**: 予防的・検知的統制
- **Account Factory**: 標準化されたアカウント作成
- **ダッシュボード**: 統合管理画面

ガードレール

- **必須ガードレール**: 基本的なセキュリティ統制
- **強く推奨**: ベストプラクティス統制
- **選択的**: 組織固有の要件
- **予防的・検知的**: 事前防止と事後検知

---

## セキュリティ設計パターン

### 多層防御 (Defense in Depth)

ネットワーク層

- **VPC分離**: ワークロード別の論理分離
- **セキュリティグループ**: インスタンスレベル制御
- **NACL**: サブネットレベル制御
- **WAF**: アプリケーション層保護

アプリケーション層

- **認証・認可**: 強固なアクセス制御
- **入力検証**: SQLインジェクション、XSS対策
- **セッション管理**: 安全なセッション処理
- **ログ記録**: セキュリティイベントの記録

データ層

- **暗号化**: 保存時・転送時暗号化
- **アクセス制御**: 最小権限の原則
- **バックアップ**: データ保護・復旧
- **監査**: データアクセスの記録

### ゼロトラストアーキテクチャ

基本原則

- **信頼の検証**: すべてのアクセスを検証
- **最小権限**: 必要最小限のアクセス
- **継続的監視**: 常時セキュリティ監視
- **動的ポリシー**: 状況に応じた動的制御

実装要素

- **アイデンティティ**: 強固な認証・認可
- **デバイス**: デバイス信頼性の検証
- **ネットワーク**: マイクロセグメンテーション
- **アプリケーション**: アプリケーションレベル制御

### セキュリティ自動化

Infrastructure as Code

- **CloudFormation**: セキュリティ設定の標準化
- **CDK**: プログラマティックなセキュリティ実装
- **Terraform**: マルチクラウド対応
- **バージョン管理**: 設定変更の追跡

自動対応

- **EventBridge**: イベント駆動の自動対応
- **Lambda**: カスタム対応ロジック
- **Systems Manager**: 自動パッチ適用
- **Security Hub**: 統合的な自動対応

### インシデント対応

準備フェーズ

- **対応計画**: インシデント対応手順書
- **チーム体制**: 役割・責任の明確化
- **ツール準備**: 対応ツールの事前準備
- **訓練**: 定期的な対応訓練

検知・分析

- **監視**: 24/7セキュリティ監視
- **アラート**: 重要度に応じたアラート
- **分析**: インシデントの影響範囲特定
- **分類**: インシデントの重要度分類

封じ込め・根絶

- **隔離**: 影響範囲の拡大防止
- **証拠保全**: フォレンジック証拠の保全
- **根本原因**: 攻撃手法・脆弱性の特定
- **対策実装**: 再発防止策の実装

復旧・事後対応

- **システム復旧**: 正常状態への復旧
- **監視強化**: 再発監視の強化
- **報告**: ステークホルダーへの報告
- **改善**: 対応プロセスの改善

---

## まとめ

### 試験でのポイント

セキュリティ設計の判断基準

1. **脅威モデル**: 想定される脅威・攻撃手法
2. **リスク評価**: ビジネス影響度・発生確率
3. **コンプライアンス**: 法的・規制要件
4. **コスト**: セキュリティ投資とリスクのバランス
5. **運用性**: 管理負荷・ユーザビリティ

よくあるセキュリティパターン

- **多層防御**: 複数レイヤーでの保護
- **ゼロトラスト**: 信頼の検証・最小権限
- **自動化**: セキュリティ運用の自動化
- **統合管理**: 統一されたセキュリティ管理

IAM設計のベストプラクティス

- **最小権限**: 必要最小限の権限付与
- **ロール活用**: 一時的認証情報の使用
- **MFA**: 多要素認証の実装
- **定期レビュー**: アクセス権限の見直し

データ保護戦略

- **暗号化**: 保存時・転送時の暗号化
- **キー管理**: 適切なキーライフサイクル
- **アクセス制御**: データへの適切なアクセス制御
- **監査**: データアクセスの記録・監視

---

## ライセンス

このコンテンツは MIT License の下で公開されています。詳細は [LICENSE](./LICENSE) ファイルをご確認ください。
